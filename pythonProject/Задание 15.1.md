# Домашнее задание к занятию "15.1. Организация сети"

Домашнее задание будет состоять из обязательной части, которую необходимо выполнить на провайдере Яндекс.Облако и дополнительной части в AWS по желанию. Все домашние задания в 15 блоке связаны друг с другом и в конце представляют пример законченной инфраструктуры.  
Все задания требуется выполнить с помощью Terraform, результатом выполненного домашнего задания будет код в репозитории. 

Перед началом работ следует настроить доступ до облачных ресурсов из Terraform используя материалы прошлых лекций и [ДЗ](https://github.com/netology-code/virt-homeworks/tree/master/07-terraform-02-syntax ). А также заранее выбрать регион (в случае AWS) и зону.

---
## Задание 1. Яндекс.Облако (обязательное к выполнению)

1. Создать VPC.
- Создать пустую VPC. Выбрать зону.

![image](https://user-images.githubusercontent.com/40559167/219947164-09d21675-f803-4e11-a213-82971ad5afca.png)
2. Публичная подсеть.
- Создать в vpc subnet с названием public, сетью 192.168.10.0/24.
![image](https://user-images.githubusercontent.com/40559167/219947184-65a87404-184e-4c97-9e09-206af56742c8.png)
- Создать в этой подсети NAT-инстанс, присвоив ему адрес 192.168.10.254. В качестве image_id использовать fd80mrhj8fl2oe87o4e1
- Создать в этой публичной подсети виртуалку с публичным IP и подключиться к ней, убедиться что есть доступ к интернету.
![image](https://user-images.githubusercontent.com/40559167/219947261-f6b90b0e-170b-4b76-ad91-ecb76d21dc44.png)
3. Приватная подсеть.
- Создать в vpc subnet с названием private, сетью 192.168.20.0/24.
![image](https://user-images.githubusercontent.com/40559167/219947276-96b1f095-aa31-45aa-9582-2a3c6d4cc756.png)
- Создать route table. Добавить статический маршрут, направляющий весь исходящий трафик private сети в NAT-инстанс
![image](https://user-images.githubusercontent.com/40559167/219947336-5885a089-b90f-4444-b170-bb89fba6afad.png)
- Создать в этой приватной подсети виртуалку с внутренним IP, подключиться к ней через виртуалку, созданную ранее и убедиться что есть доступ к интернету
![image](https://user-images.githubusercontent.com/40559167/219947308-24e4cc41-5fb3-49cf-8eed-3335b48b6ff4.png)
```
www@www:~$ ssh 158.160.29.91
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun Feb 19 12:07:56 PM UTC 2023

  System load:  0.0                Processes:             136
  Usage of /:   28.0% of 14.68GB   Users logged in:       0
  Memory usage: 13%                IPv4 address for eth0: 192.168.10.253
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

Last login: Sun Feb 19 12:04:41 2023 from 
www@netology-public:~$ ping 192.168.20.34
PING 192.168.20.34 (192.168.20.34) 56(84) bytes of data.
64 bytes from 192.168.20.34: icmp_seq=1 ttl=63 time=0.789 ms
64 bytes from 192.168.20.34: icmp_seq=2 ttl=63 time=0.310 ms
64 bytes from 192.168.20.34: icmp_seq=3 ttl=63 time=0.578 ms
64 bytes from 192.168.20.34: icmp_seq=4 ttl=63 time=0.347 ms
^C
--- 192.168.20.34 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3064ms
rtt min/avg/max/mdev = 0.310/0.506/0.789/0.192 ms
www@netology-public:~$ ssh 192.168.20.34
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-58-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun Feb 19 12:08:37 PM UTC 2023

  System load:  0.0595703125       Processes:             172
  Usage of /:   28.0% of 14.68GB   Users logged in:       0
  Memory usage: 11%                IPv4 address for eth0: 192.168.20.34
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.
```
Resource terraform для ЯО
- [VPC subnet](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/vpc_subnet)
- [Route table](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/vpc_route_table)
- [Compute Instance](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/compute_instance)
---
## Задание 2*. AWS (необязательное к выполнению)

1. Создать VPC.
- Cоздать пустую VPC с подсетью 10.10.0.0/16.
2. Публичная подсеть.
- Создать в vpc subnet с названием public, сетью 10.10.1.0/24
- Разрешить в данной subnet присвоение public IP по-умолчанию. 
- Создать Internet gateway 
- Добавить в таблицу маршрутизации маршрут, направляющий весь исходящий трафик в Internet gateway.
- Создать security group с разрешающими правилами на SSH и ICMP. Привязать данную security-group на все создаваемые в данном ДЗ виртуалки
- Создать в этой подсети виртуалку и убедиться, что инстанс имеет публичный IP. Подключиться к ней, убедиться что есть доступ к интернету.
- Добавить NAT gateway в public subnet.
3. Приватная подсеть.
- Создать в vpc subnet с названием private, сетью 10.10.2.0/24
- Создать отдельную таблицу маршрутизации и привязать ее к private-подсети
- Добавить Route, направляющий весь исходящий трафик private сети в NAT.
- Создать виртуалку в приватной сети.
- Подключиться к ней по SSH по приватному IP через виртуалку, созданную ранее в публичной подсети и убедиться, что с виртуалки есть выход в интернет.

Resource terraform
- [VPC](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc)
- [Subnet](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/subnet)
- [Internet Gateway](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/internet_gateway)
