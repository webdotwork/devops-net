# Домашнее задание к занятию "13.3 работа с kubectl"
## Задание 1: проверить работоспособность каждого компонента
Для проверки работы можно использовать 2 способа: port-forward и exec. Используя оба способа, проверьте каждый компонент:
```
www@www:~/Desktop/CI$ sudo kubectl get ns
NAME              STATUS        AGE
argocd            Active        6d2h
default           Active        10d
ingress-nginx     Active        10d
kube-node-lease   Active        10d
kube-public       Active        10d
kube-system       Active        10d
stg               Active        38
www@www:~/Desktop/CI$ sudo kubectl -n stg get po -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP             NODE    NOMINATED NODE   READINESS GATES
backend-584f9565d8-lxfrb    1/1     Running   0          6m45s   10.233.75.39   node2   <none>           <none>
frontend-7d996c486d-9xpnp   1/1     Running   0          34m     10.233.75.38   node2   <none>           <none>
postgres-0                  1/1     Running   0          39m     10.233.75.36   node2   <none>           <none>
```
* сделайте запросы к бекенду;
```
www@www:~/Desktop/CI$ sudo kubectl port-forward backend-584f9565d8-lxfrb -n stg 9090:80
Forwarding from 127.0.0.1:9090 -> 80
Forwarding from [::1]:9090 -> 80
Handling connection for 9090
www@www:~/Desktop/CI$ curl -s 127.0.0.1:9090
Praqma Network MultiTool (with NGINX) - backend-584f9565d8-lxfrb - 10.233.75.39 - HTTP: 80 , HTTPS: 443
<br>
<hr>
<br>

<h1>05 Jan 2022 - Press-release: `Praqma/Network-Multitool` is now `wbitt/Network-Multitool`</h1>

<h2>Important note about name/org change:</h2>
<p>
Few years ago, I created this tool with Henrik Høegh, as `praqma/network-multitool`. Praqma was bought by another company, and now the "Praqma" brand is being dismantled. This means the network-multitool's git and docker repositories must go. Since, I was the one maintaining the docker image for all these years, it was decided by the current representatives of the company to hand it over to me so I can continue maintaining it. So, apart from a small change in the repository name, nothing has changed.<br>
</p>
<p>
The existing/old/previous container image `praqma/network-multitool` will continue to work and will remain available for **"some time"** - may be for a couple of months - not sure though. 
</p>
<p>
- Kamran Azeem <kamranazeem@gmail.com> <a href=https://github.com/KamranAzeem>https://github.com/KamranAzeem</a>
</p>

<h2>Some important URLs:</h2>

<ul>
  <li>The new official github repository for this tool is: <a href=https://github.com/wbitt/Network-MultiTool>https://github.com/wbitt/Network-MultiTool</a></li>

  <li>The docker repository to pull this image is now: <a href=https://hub.docker.com/r/wbitt/network-multitool>https://hub.docker.com/r/wbitt/network-multitool</a></li>
</ul>

<br>
Or:
<br>

<pre>
  <code>
  docker pull wbitt/network-multitool
  </code>
</pre>


<hr>
www@www:~/Desktop/CI$ sudo kubectl exec backend-584f9565d8-lxfrb -n stg  -- netstat -nltp 
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1/nginx: master pro 
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      1/nginx: master pro
```
* сделайте запросы к фронту;
```
www@www:~/Desktop/CI$ sudo kubectl port-forward frontend-7d996c486d-9xpnp -n stg 9090:80
Forwarding from 127.0.0.1:9090 -> 80
Forwarding from [::1]:9090 -> 80
Handling connection for 9090
www@www:~/Desktop/CI$ curl 127.0.0.1:9090
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
www@www:~/Desktop/CI$ sudo kubectl exec frontend-7d996c486d-9xpnp -n stg  -- netstat -nltp 
error: Internal error occurred: error executing command in container: failed to exec in container: failed to start exec "6f5876fb88253dd190bff34d6cf1e6bc5b558a79a0b0ca7296256f8a1a31190b": OCI runtime exec failed: exec failed: unable to start container process: exec: "netstat": executable file not found in $PATH: unknown
```
* подключитесь к базе данных.
```
www@www:~/Desktop/CI$ sudo kubectl port-forward postgres-0 -n stg 5432:5432
Forwarding from 127.0.0.1:5432 -> 5432
Forwarding from [::1]:5432 -> 5432
Handling connection for 5432
www@www:~/Desktop/CI$ sudo psql -U postgres -h 127.0.0.1 -d postgres
psql (12.12 (Ubuntu 12.12-0ubuntu0.20.04.1), server 15.1)
WARNING: psql major version 12, server major version 15.
         Some psql features might not work.
Type "help" for help.

postgres=#

```

## Задание 2: ручное масштабирование

При работе с приложением иногда может потребоваться вручную добавить пару копий. Используя команду kubectl scale, попробуйте увеличить количество бекенда и фронта до 3. Проверьте, на каких нодах оказались копии после каждого действия (kubectl describe, kubectl get pods -o wide). После уменьшите количество копий до 1.
```
www@www:~/Desktop/CI$ sudo kubectl -n dev get po -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP             NODE    NOMINATED NODE   READINESS GATES
backend-584f9565d8-vk6gm    1/1     Running   0          112s    10.233.75.41   node2   <none>           <none>
database-78f9bd65-5jcrk     1/1     Running   0          2m32s   10.233.75.40   node2   <none>           <none>
frontend-7d996c486d-mtzpz   1/1     Running   0          89s     10.233.75.42   node2   <none>           <none>
www@www:~/Desktop/CI/sl/kubernetes$ sudo kubectl scale --replicas=3 -n dev deployment frontend backend database
deployment.apps/frontend scaled
deployment.apps/backend scaled
deployment.apps/database scaled
www@www:~/Desktop/CI$ sudo kubectl -n dev get po -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP             NODE     NOMINATED NODE   READINESS GATES
backend-584f9565d8-k6n5z    0/1     Pending   0          14s     <none>         <none>   <none>           <none>
backend-584f9565d8-vk6gm    1/1     Running   0          4m4s    10.233.75.41   node2    <none>           <none>
backend-584f9565d8-z8zmt    0/1     Pending   0          14s     <none>         <none>   <none>           <none>
database-78f9bd65-5jcrk     1/1     Running   0          4m44s   10.233.75.40   node2    <none>           <none>
database-78f9bd65-gksmg     1/1     Running   0          14s     10.233.75.45   node2    <none>           <none>
database-78f9bd65-tgk9l     1/1     Running   0          14s     10.233.75.44   node2    <none>           <none>
frontend-7d996c486d-jnsjk   1/1     Running   0          14s     10.233.75.43   node2    <none>           <none>
frontend-7d996c486d-l87h7   0/1     Pending   0          14s     <none>         <none>   <none>           <none>
frontend-7d996c486d-mtzpz   1/1     Running   0          3m41s   10.233.75.42   node2    <none>           <none>
www@www:~/Desktop/CI$ sudo kubectl -n dev get deployment -o wide
NAME       READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                     SELECTOR
backend    1/3     3            1           4m19s   backend      praqma/network-multitool   app=backend
database   3/3     3            3           5m      postgres     postgres:alpine            app=database
frontend   2/3     3            2           3m56s   frontend     nginx:stable               app=frontend
www@www:~/Desktop/CI$ sudo kubectl scale --replicas=1 -n dev deployment frontend backend database
deployment.apps/frontend scaled
deployment.apps/backend scaled
deployment.apps/database scaled
www@www:~/Desktop/CI$ sudo kubectl -n dev get deployment -o wide
NAME       READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS   IMAGES                     SELECTOR
backend    1/1     1            1           9m54s   backend      praqma/network-multitool   app=backend
database   1/1     1            1           10m     postgres     postgres:alpine            app=database
frontend   1/1     1            1           9m31s   frontend     nginx:stable               app=frontend
www@www:~/Desktop/CI/sl/kubernetes$ sudo kubectl describe nodes
Name:               node1
Roles:              control-plane
Labels:             beta.kubernetes.io/arch=amd64
                    beta.kubernetes.io/os=linux
                    kubernetes.io/arch=amd64
                    kubernetes.io/hostname=node1
                    kubernetes.io/os=linux
                    node-role.kubernetes.io/control-plane=
                    node.kubernetes.io/exclude-from-external-load-balancers=
Annotations:        kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/containerd/containerd.sock
                    node.alpha.kubernetes.io/ttl: 0
                    projectcalico.org/IPv4Address: 10.0.40.46/24
                    projectcalico.org/IPv4VXLANTunnelAddr: 10.233.102.128
                    volumes.kubernetes.io/controller-managed-attach-detach: true
CreationTimestamp:  Sat, 24 Dec 2022 12:43:47 +0300
Taints:             node-role.kubernetes.io/master:NoSchedule
Unschedulable:      false
Lease:
  HolderIdentity:  node1
  AcquireTime:     <unset>
  RenewTime:       Tue, 03 Jan 2023 19:03:12 +0300
Conditions:
  Type                 Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  ----                 ------  -----------------                 ------------------                ------                       -------
  NetworkUnavailable   False   Sat, 24 Dec 2022 12:45:12 +0300   Sat, 24 Dec 2022 12:45:12 +0300   CalicoIsUp                   Calico is running on this node
  MemoryPressure       False   Tue, 03 Jan 2023 19:03:09 +0300   Sat, 24 Dec 2022 12:43:46 +0300   KubeletHasSufficientMemory   kubelet has sufficient memory available
  DiskPressure         False   Tue, 03 Jan 2023 19:03:09 +0300   Sat, 24 Dec 2022 12:43:46 +0300   KubeletHasNoDiskPressure     kubelet has no disk pressure
  PIDPressure          False   Tue, 03 Jan 2023 19:03:09 +0300   Sat, 24 Dec 2022 12:43:46 +0300   KubeletHasSufficientPID      kubelet has sufficient PID available
  Ready                True    Tue, 03 Jan 2023 19:03:09 +0300   Sat, 24 Dec 2022 12:46:08 +0300   KubeletReady                 kubelet is posting ready status. AppArmor enabled
Addresses:
  InternalIP:  10.0.40.46
  Hostname:    node1
Capacity:
  cpu:                2
  ephemeral-storage:  50620216Ki
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             2041168Ki
  pods:               110
Allocatable:
  cpu:                1800m
  ephemeral-storage:  46651590989
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             1414480Ki
  pods:               110
System Info:
  Machine ID:                 20727de74bd3427cbdcec0abd6c5fd3e
  System UUID:                564D6799-84D6-2CDE-3032-A6DF952CF8A4
  Boot ID:                    882c384d-bc46-4f1d-b6d0-44bb07528767
  Kernel Version:             4.15.0-200-generic
  OS Image:                   Ubuntu 18.04.6 LTS
  Operating System:           linux
  Architecture:               amd64
  Container Runtime Version:  containerd://1.6.10
  Kubelet Version:            v1.25.4
  Kube-Proxy Version:         v1.25.4
PodCIDR:                      10.233.64.0/24
PodCIDRs:                     10.233.64.0/24
Non-terminated Pods:          (9 in total)
  Namespace                   Name                               CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age
  ---------                   ----                               ------------  ----------  ---------------  -------------  ---
  kube-system                 calico-node-7wpr4                  150m (8%)     300m (16%)  64M (4%)         500M (34%)     10d
  kube-system                 coredns-588bb58b94-2x7sx           100m (5%)     0 (0%)      70Mi (5%)        300Mi (21%)    10d
  kube-system                 dns-autoscaler-5b9959d7fc-qxsts    20m (1%)      0 (0%)      10Mi (0%)        0 (0%)         10d
  kube-system                 kube-apiserver-node1               250m (13%)    0 (0%)      0 (0%)           0 (0%)         10d
  kube-system                 kube-controller-manager-node1      200m (11%)    0 (0%)      0 (0%)           0 (0%)         10d
  kube-system                 kube-proxy-6p4l8                   0 (0%)        0 (0%)      0 (0%)           0 (0%)         10d
  kube-system                 kube-scheduler-node1               100m (5%)     0 (0%)      0 (0%)           0 (0%)         10d
  kube-system                 metrics-server-5c9dd56466-2cz9p    100m (5%)     100m (5%)   200Mi (14%)      200Mi (14%)    10d
  kube-system                 nodelocaldns-2l8q8                 100m (5%)     0 (0%)      70Mi (5%)        200Mi (14%)    10d
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  Resource           Requests         Limits
  --------           --------         ------
  cpu                1020m (56%)      400m (22%)
  memory             431001600 (29%)  1234003200 (85%)
  ephemeral-storage  0 (0%)           0 (0%)
  hugepages-1Gi      0 (0%)           0 (0%)
  hugepages-2Mi      0 (0%)           0 (0%)
Events:              <none>


Name:               node2
Roles:              <none>
Labels:             beta.kubernetes.io/arch=amd64
                    beta.kubernetes.io/os=linux
                    kubernetes.io/arch=amd64
                    kubernetes.io/hostname=node2
                    kubernetes.io/os=linux
Annotations:        kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/containerd/containerd.sock
                    node.alpha.kubernetes.io/ttl: 0
                    projectcalico.org/IPv4Address: 10.0.40.149/24
                    projectcalico.org/IPv4VXLANTunnelAddr: 10.233.75.0
                    volumes.kubernetes.io/controller-managed-attach-detach: true
CreationTimestamp:  Sat, 24 Dec 2022 12:44:44 +0300
Taints:             <none>
Unschedulable:      false
Lease:
  HolderIdentity:  node2
  AcquireTime:     <unset>
  RenewTime:       Tue, 03 Jan 2023 19:03:06 +0300
Conditions:
  Type                 Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  ----                 ------  -----------------                 ------------------                ------                       -------
  NetworkUnavailable   False   Sat, 24 Dec 2022 12:45:12 +0300   Sat, 24 Dec 2022 12:45:12 +0300   CalicoIsUp                   Calico is running on this node
  MemoryPressure       False   Tue, 03 Jan 2023 19:03:10 +0300   Sat, 24 Dec 2022 12:44:43 +0300   KubeletHasSufficientMemory   kubelet has sufficient memory available
  DiskPressure         False   Tue, 03 Jan 2023 19:03:10 +0300   Sat, 24 Dec 2022 12:44:43 +0300   KubeletHasNoDiskPressure     kubelet has no disk pressure
  PIDPressure          False   Tue, 03 Jan 2023 19:03:10 +0300   Sat, 24 Dec 2022 12:44:43 +0300   KubeletHasSufficientPID      kubelet has sufficient PID available
  Ready                True    Tue, 03 Jan 2023 19:03:10 +0300   Sat, 24 Dec 2022 12:46:08 +0300   KubeletReady                 kubelet is posting ready status. AppArmor enabled
Addresses:
  InternalIP:  10.0.40.149
  Hostname:    node2
Capacity:
  cpu:                2
  ephemeral-storage:  50620216Ki
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             2041168Ki
  pods:               110
Allocatable:
  cpu:                1900m
  ephemeral-storage:  46651590989
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             1676624Ki
  pods:               110
System Info:
  Machine ID:                 09dc524f7d9a403598c70a71805245ec
  System UUID:                564DE873-A6F0-F92F-58E1-4E5E46F153AE
  Boot ID:                    c31ffa85-e361-41af-b46b-e72b66776dab
  Kernel Version:             4.15.0-200-generic
  OS Image:                   Ubuntu 18.04.6 LTS
  Operating System:           linux
  Architecture:               amd64
  Container Runtime Version:  containerd://1.6.10
  Kubelet Version:            v1.25.4
  Kube-Proxy Version:         v1.25.4
PodCIDR:                      10.233.65.0/24
PodCIDRs:                     10.233.65.0/24
Non-terminated Pods:          (20 in total)
  Namespace                   Name                                                 CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age
  ---------                   ----                                                 ------------  ----------  ---------------  -------------  ---
  argocd                      argocd-application-controller-0                      0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  argocd                      argocd-applicationset-controller-74575b6959-jpkrj    0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  argocd                      argocd-dex-server-64897989f8-pn8bp                   0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  argocd                      argocd-notifications-controller-566bc99494-jcjlf     0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  argocd                      argocd-redis-79c755c747-q9zql                        0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  argocd                      argocd-repo-server-bc9c646dc-8knw8                   0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  argocd                      argocd-server-757fddb4d7-bwhtn                       0 (0%)        0 (0%)      0 (0%)           0 (0%)         6d3h
  dev                         backend-584f9565d8-vk6gm                             100m (5%)     200m (10%)  256Mi (15%)      512Mi (31%)    10m
  dev                         database-78f9bd65-5jcrk                              0 (0%)        0 (0%)      0 (0%)           0 (0%)         11m
  dev                         frontend-7d996c486d-jnsjk                            100m (5%)     200m (10%)  256Mi (15%)      512Mi (31%)    6m34s
  ingress-nginx               ingress-nginx-controller-4kt9n                       0 (0%)        0 (0%)      0 (0%)           0 (0%)         10d
  kube-system                 calico-kube-controllers-d6484b75c-qkklj              30m (1%)      1 (52%)     64M (3%)         256M (14%)     10d
  kube-system                 calico-node-vqj6f                                    150m (7%)     300m (15%)  64M (3%)         500M (29%)     10d
  kube-system                 coredns-588bb58b94-2jtm5                             100m (5%)     0 (0%)      70Mi (4%)        300Mi (18%)    10d
  kube-system                 kube-proxy-tfxg8                                     0 (0%)        0 (0%)      0 (0%)           0 (0%)         10d
  kube-system                 nginx-proxy-node2                                    25m (1%)      0 (0%)      32M (1%)         0 (0%)         10d
  kube-system                 nodelocaldns-t4mwq                                   100m (5%)     0 (0%)      70Mi (4%)        200Mi (12%)    10d
  stg                         backend-584f9565d8-lxfrb                             100m (5%)     200m (10%)  256Mi (15%)      512Mi (31%)    49m
  stg                         frontend-7d996c486d-9xpnp                            100m (5%)     200m (10%)  256Mi (15%)      512Mi (31%)    77m
  stg                         postgres-0                                           0 (0%)        0 (0%)      0 (0%)           0 (0%)         82m
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  Resource           Requests         Limits
  --------           --------         ------
  cpu                805m (42%)       2100m (110%)
  memory             1348186Ki (80%)  3427771648 (199%)
  ephemeral-storage  0 (0%)           0 (0%)
  hugepages-1Gi      0 (0%)           0 (0%)
  hugepages-2Mi      0 (0%)           0 (0%)
Events:              <none>
```
---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
