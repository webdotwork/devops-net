# Домашнее задание к занятию "13.3 работа с kubectl"
## Задание 1: проверить работоспособность каждого компонента
Для проверки работы можно использовать 2 способа: port-forward и exec. Используя оба способа, проверьте каждый компонент:
```
www@www:~/Desktop/CI$ sudo kubectl get ns
NAME              STATUS        AGE
argocd            Active        6d2h
default           Active        10d
ingress-nginx     Active        10d
kube-node-lease   Active        10d
kube-public       Active        10d
kube-system       Active        10d
stg               Active        38
www@www:~/Desktop/CI$ sudo kubectl -n stg get po -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP             NODE    NOMINATED NODE   READINESS GATES
backend-584f9565d8-lxfrb    1/1     Running   0          6m45s   10.233.75.39   node2   <none>           <none>
frontend-7d996c486d-9xpnp   1/1     Running   0          34m     10.233.75.38   node2   <none>           <none>
postgres-0                  1/1     Running   0          39m     10.233.75.36   node2   <none>           <none>
```
* сделайте запросы к бекенду;
```
www@www:~/Desktop/CI$ sudo kubectl port-forward backend-584f9565d8-lxfrb -n stg 9090:80
Forwarding from 127.0.0.1:9090 -> 80
Forwarding from [::1]:9090 -> 80
Handling connection for 9090
www@www:~/Desktop/CI$ curl -s 127.0.0.1:9090
Praqma Network MultiTool (with NGINX) - backend-584f9565d8-lxfrb - 10.233.75.39 - HTTP: 80 , HTTPS: 443
<br>
<hr>
<br>

<h1>05 Jan 2022 - Press-release: `Praqma/Network-Multitool` is now `wbitt/Network-Multitool`</h1>

<h2>Important note about name/org change:</h2>
<p>
Few years ago, I created this tool with Henrik Høegh, as `praqma/network-multitool`. Praqma was bought by another company, and now the "Praqma" brand is being dismantled. This means the network-multitool's git and docker repositories must go. Since, I was the one maintaining the docker image for all these years, it was decided by the current representatives of the company to hand it over to me so I can continue maintaining it. So, apart from a small change in the repository name, nothing has changed.<br>
</p>
<p>
The existing/old/previous container image `praqma/network-multitool` will continue to work and will remain available for **"some time"** - may be for a couple of months - not sure though. 
</p>
<p>
- Kamran Azeem <kamranazeem@gmail.com> <a href=https://github.com/KamranAzeem>https://github.com/KamranAzeem</a>
</p>

<h2>Some important URLs:</h2>

<ul>
  <li>The new official github repository for this tool is: <a href=https://github.com/wbitt/Network-MultiTool>https://github.com/wbitt/Network-MultiTool</a></li>

  <li>The docker repository to pull this image is now: <a href=https://hub.docker.com/r/wbitt/network-multitool>https://hub.docker.com/r/wbitt/network-multitool</a></li>
</ul>

<br>
Or:
<br>

<pre>
  <code>
  docker pull wbitt/network-multitool
  </code>
</pre>


<hr>
www@www:~/Desktop/CI$ sudo kubectl exec backend-584f9565d8-lxfrb -n stg  -- netstat -nltp 
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1/nginx: master pro 
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      1/nginx: master pro
```
* сделайте запросы к фронту;
```
www@www:~/Desktop/CI$ sudo kubectl port-forward frontend-7d996c486d-9xpnp -n stg 9090:80
Forwarding from 127.0.0.1:9090 -> 80
Forwarding from [::1]:9090 -> 80
Handling connection for 9090
www@www:~/Desktop/CI$ curl 127.0.0.1:9090
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
www@www:~/Desktop/CI$ sudo kubectl exec frontend-7d996c486d-9xpnp -n stg  -- netstat -nltp 
error: Internal error occurred: error executing command in container: failed to exec in container: failed to start exec "6f5876fb88253dd190bff34d6cf1e6bc5b558a79a0b0ca7296256f8a1a31190b": OCI runtime exec failed: exec failed: unable to start container process: exec: "netstat": executable file not found in $PATH: unknown
```
* подключитесь к базе данных.
```
www@www:~/Desktop/CI$ sudo kubectl port-forward postgres-0 -n stg 5432:5432
Forwarding from 127.0.0.1:5432 -> 5432
Forwarding from [::1]:5432 -> 5432
Handling connection for 5432
www@www:~/Desktop/CI$ sudo psql -U postgres -h 127.0.0.1 -d postgres
psql (12.12 (Ubuntu 12.12-0ubuntu0.20.04.1), server 15.1)
WARNING: psql major version 12, server major version 15.
         Some psql features might not work.
Type "help" for help.

postgres=#

```

## Задание 2: ручное масштабирование

При работе с приложением иногда может потребоваться вручную добавить пару копий. Используя команду kubectl scale, попробуйте увеличить количество бекенда и фронта до 3. Проверьте, на каких нодах оказались копии после каждого действия (kubectl describe, kubectl get pods -o wide). После уменьшите количество копий до 1.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
